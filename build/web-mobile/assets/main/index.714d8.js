window.__require=function e(t,i,o){function r(s,a){if(!i[s]){if(!t[s]){var l=s.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!a&&c)return c(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+s+"'")}s=l}var h=i[s]={exports:{}};t[s][0].call(h.exports,function(e){return r(t[s][1][e]||e)},h,h.exports,e,t,i,o)}return i[s].exports}for(var n="function"==typeof __require&&__require,s=0;s<o.length;s++)r(o[s]);return r}({GameController:[function(e,t,i){"use strict";cc._RF.push(t,"f659b62Nl5OC79FdebFp/BN","GameController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),n=this&&this.__decorate||function(e,t,i,o){var r,n=arguments.length,s=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(n<3?r(s):n>3?r(t,i,s):r(t,i))||s);return n>3&&s&&Object.defineProperty(t,i,s),s},s=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(r,n){function s(e){try{l(o.next(e))}catch(t){n(t)}}function a(e){try{l(o.throw(e))}catch(t){n(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}l((o=o.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var i,o,r,n,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(e){return function(t){return l([e,t])}}function l(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(r=2&n[0]?o.return:n[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,n[1])).done)return r;switch(o=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){s.label=n[1];break}if(6===n[0]&&s.label<r[1]){s.label=r[1],r=n;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(n);break}r[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(a){n=[6,a],o=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0}),i.GameController=void 0;var l=e("./GameModel"),c=cc._decorator,h=c.ccclass,u=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameModel=null,t.tilePrefab=null,t.boardNode=null,t.scoreLabel=null,t.movesLabel=null,t.gameOverNode=null,t.gameOverLabel=null,t.tileSprites=[],t.rowBurnerSprite=null,t.columnBurnerSprite=null,t.radiusBurnerSprite=null,t.fieldBurnerSprite=null,t.boardPadding=50,t.internalPadding=20,t.tileSize=0,t.isBoardReady=!1,t.tilesContainer=null,t.isProcessingMove=!1,t.superTileConfig=null,t}return r(t,e),t.prototype.onLoad=function(){this.gameModel=new l.GameModel,this.superTileConfig=this.gameModel.getSuperTileConfig(),this.gameOverNode&&(this.gameOverNode.active=!1),this.calculateBoardSize(),this.createBoardView(),this.updateUI(),this.isBoardReady=!0,cc.view.on("canvas-resize",this.onResize,this)},t.prototype.onDestroy=function(){cc.view.off("canvas-resize",this.onResize,this)},t.prototype.onTileClick=function(e,t,i){return s(this,void 0,Promise,function(){var o,r;return a(this,function(n){switch(n.label){case 0:if(!this.isBoardReady||this.isProcessingMove)return[2];this.isProcessingMove=!0,n.label=1;case 1:return n.trys.push([1,6,7,8]),console.log("\u041a\u043b\u0438\u043a \u043f\u043e \u0442\u0430\u0439\u043b\u0443: row="+e+", col="+t+", type="+i),this.gameModel.isSuperTile(i)?(console.log("\u0410\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u043d \u0441\u0443\u043f\u0435\u0440-\u0442\u0430\u0439\u043b!"),[4,this.processSuperTileActivation(e,t,i)]):[3,3];case 2:return n.sent(),[3,5];case 3:return(o=this.gameModel.findTileGroup(e,t)).length<2?(console.log("\u0413\u0440\u0443\u043f\u043f\u0430 \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u043c\u0430\u043b\u0430 \u0434\u043b\u044f \u0441\u0436\u0438\u0433\u0430\u043d\u0438\u044f"),this.animateNoMatch(e,t),[2]):[4,this.processNormalMove(o,e,t)];case 4:n.sent(),n.label=5;case 5:return[3,8];case 6:return r=n.sent(),console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0445\u043e\u0434\u0430:",r),[3,8];case 7:return this.isProcessingMove=!1,[7];case 8:return[2]}})})},t.prototype.processSuperTileActivation=function(e,t,i){return s(this,void 0,Promise,function(){var o;return a(this,function(r){switch(r.label){case 0:return[4,this.animateSuperTileActivation(e,t)];case 1:return r.sent(),(o=this.gameModel.processMoveWithAnimations([],e,t)).activatedSuperTile?[4,this.animateSuperTileBurn(o.activatedSuperTile.burnedTiles,i)]:[3,5];case 2:return r.sent(),[4,this.animateFallingTiles(o.activatedSuperTile.movements)];case 3:return r.sent(),[4,this.animateNewTiles(o.activatedSuperTile.newTiles)];case 4:return r.sent(),[3,8];case 5:return[4,this.animateFallingTiles(o.movements)];case 6:return r.sent(),[4,this.animateNewTiles(o.newTiles)];case 7:r.sent(),r.label=8;case 8:return this.cleanupOldTiles(),o.activatedSuperTile?this.animateScorePoints(o.activatedSuperTile.points,e,t):this.animateScorePoints(o.points,e,t),this.updateUI(),this.checkGameStatus(),[2]}})})},t.prototype.processNormalMove=function(e,t,i){return s(this,void 0,Promise,function(){var o;return a(this,function(r){switch(r.label){case 0:return[4,this.removeTilesVisual(e)];case 1:return r.sent(),o=this.gameModel.processMoveWithAnimations(e,t,i),[4,this.animateFallingTiles(o.movements)];case 2:return r.sent(),[4,this.animateNewTiles(o.newTiles)];case 3:return r.sent(),o.createdSuperTile?[4,this.animateSuperTileCreation(o.createdSuperTile)]:[3,5];case 4:r.sent(),r.label=5;case 5:return this.cleanupOldTiles(),this.animateScorePoints(o.points,t,i),this.updateUI(),this.checkGameStatus(),[2]}})})},t.prototype.animateSuperTileCreation=function(e){return s(this,void 0,Promise,function(){var t=this;return a(this,function(){return[2,new Promise(function(i){var o=t.findTileNode(e.row,e.col);if(!o)return console.log("\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0442\u0430\u0439\u043b \u0434\u043b\u044f \u0441\u0443\u043f\u0435\u0440-\u0442\u0430\u0439\u043b\u0430 \u043d\u0430 \u043f\u043e\u0437\u0438\u0446\u0438\u0438 ("+e.row+", "+e.col+")"),void i();o.tileType=e.type,cc.tween(o).to(.2,{scale:1.5}).call(function(){t.setTileSprite(o,e.type)}).to(.2,{scale:1}).call(function(){o.off(cc.Node.EventType.TOUCH_END),o.on(cc.Node.EventType.TOUCH_END,function(){t.onTileClick(e.row,e.col,e.type)}),i()}).start()})]})})},t.prototype.animateSuperTileActivation=function(e,t){return s(this,void 0,Promise,function(){var i=this;return a(this,function(){return[2,new Promise(function(o){var r=i.findTileNode(e,t);r?cc.tween(r).parallel(cc.tween().to(.3,{scale:3},{easing:"backOut"}),cc.tween().to(.3,{opacity:0})).call(function(){r.destroy(),o()}).start():o()})]})})},t.prototype.animateSuperTileBurn=function(e,t){return s(this,void 0,Promise,function(){var i=this;return a(this,function(){return[2,new Promise(function(o){if(0!==e.length)for(var r=0,n=i.getSuperTileEffectColor(t),s=function(t){var s=i.findTileNode(t.row,t.col);s?cc.tween(s).to(.2,{scale:1.3,color:n}).to(.2,{scale:0,opacity:0}).call(function(){s.destroy(),++r===e.length&&o()}).start():++r===e.length&&o()},a=0,l=e;a<l.length;a++)s(l[a]);else o()})]})})},t.prototype.getSuperTileEffectColor=function(e){switch(e){case this.superTileConfig.types.ROW_BURNER:return cc.Color.RED;case this.superTileConfig.types.COLUMN_BURNER:return cc.Color.BLUE;case this.superTileConfig.types.RADIUS_BURNER:return cc.Color.ORANGE;case this.superTileConfig.types.FIELD_BURNER:return cc.Color.MAGENTA;default:return cc.Color.WHITE}},t.prototype.setTileSprite=function(e,t){var i,o=e.getComponent(cc.Sprite);if(o){if(this.gameModel.isSuperTile(t)){switch(t){case this.superTileConfig.types.ROW_BURNER:this.rowBurnerSprite&&(o.spriteFrame=this.rowBurnerSprite);break;case this.superTileConfig.types.COLUMN_BURNER:this.columnBurnerSprite&&(o.spriteFrame=this.columnBurnerSprite);break;case this.superTileConfig.types.RADIUS_BURNER:this.radiusBurnerSprite&&(o.spriteFrame=this.radiusBurnerSprite);break;case this.superTileConfig.types.FIELD_BURNER:this.fieldBurnerSprite&&(o.spriteFrame=this.fieldBurnerSprite)}null===(i=e.getComponent(cc.Sprite)._sgNode)||void 0===i||i.setState(cc.Sprite.State.GRAY)}else if(this.tileSprites.length>t)o.spriteFrame=this.tileSprites[t];else{var r=[cc.Color.RED,cc.Color.GREEN,cc.Color.BLUE,cc.Color.YELLOW,cc.Color.MAGENTA];o.node.color=r[t]||cc.Color.WHITE}o.sizeMode=cc.Sprite.SizeMode.CUSTOM}},t.prototype.calculateBoardSize=function(){var e=cc.view.getVisibleSize(),t=this.gameModel.getWidth(),i=this.gameModel.getHeight(),o=(e.width-2*this.boardPadding)/t,r=(e.height-2*this.boardPadding)/i;this.tileSize=Math.min(o,r);var n=t*this.tileSize+2*this.internalPadding,s=i*this.tileSize+2*this.internalPadding;this.boardNode.setContentSize(n,s),this.boardNode.setPosition(0,0),this.setupBoardBorder(),console.log("\u0420\u0430\u0437\u043c\u0435\u0440 Board: "+n+"x"+s),console.log("\u0420\u0430\u0437\u043c\u0435\u0440 \u0442\u0430\u0439\u043b\u0430: "+this.tileSize),console.log("\u0412\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0438\u0435 \u043e\u0442\u0441\u0442\u0443\u043f\u044b: "+this.internalPadding)},t.prototype.onResize=function(){var e=this;this.isBoardReady&&(console.log("\u0410\u0434\u0430\u043f\u0442\u0438\u0440\u0443\u0435\u043c \u043f\u043e\u043b\u0435 \u043a \u043d\u043e\u0432\u043e\u043c\u0443 \u0440\u0430\u0437\u043c\u0435\u0440\u0443 \u044d\u043a\u0440\u0430\u043d\u0430..."),this.scheduleOnce(function(){e.calculateBoardSize(),e.recreateBoardView()},.1))},t.prototype.createBoardView=function(){var e=this.gameModel.getBoard(),t=this.gameModel.getWidth(),i=this.gameModel.getHeight();this.tilesContainer=new cc.Node("TilesContainer"),this.tilesContainer.setPosition(0,0),this.boardNode.addChild(this.tilesContainer);for(var o=0;o<i;o++)for(var r=0;r<t;r++)this.createTile(o,r,e[o][r])},t.prototype.createTile=function(e,t,i){var o=this,r=cc.instantiate(this.tilePrefab),n=t*this.tileSize+this.tileSize/2-this.gameModel.getWidth()*this.tileSize/2,s=-e*this.tileSize-this.tileSize/2+this.gameModel.getHeight()*this.tileSize/2;r.setPosition(n,s),r.setContentSize(this.tileSize,this.tileSize),this.tilesContainer.addChild(r),this.setTileSprite(r,i),this.animateTileAppearance(r),r.on(cc.Node.EventType.TOUCH_END,function(){o.onTileClick(e,t,i)}),r.tileRow=e,r.tileCol=t,r.tileType=i},t.prototype.animateTileAppearance=function(e){e.scale=0,cc.tween(e).to(.2,{scale:1},{easing:"backOut"}).start()},t.prototype.animateFallingTiles=function(e){var t=this;return new Promise(function(i){if(0!==e.length)for(var o=0,r=function(r){var n=t.findTileNode(r.from.row,r.from.col);if(n){n.off(cc.Node.EventType.TOUCH_END),n.tileRow=r.to.row,n.tileCol=r.to.col;var s=r.to.col*t.tileSize+t.tileSize/2-t.gameModel.getWidth()*t.tileSize/2,a=-r.to.row*t.tileSize-t.tileSize/2+t.gameModel.getHeight()*t.tileSize/2;cc.tween(n).to(.3,{x:s,y:a},{easing:"sineOut"}).call(function(){var s=r.to.row,a=r.to.col,l=t.gameModel.getBoard()[s][a];n.off(cc.Node.EventType.TOUCH_END),n.on(cc.Node.EventType.TOUCH_END,function(){t.onTileClick(s,a,l)}),++o===e.length&&i()}).start()}else++o===e.length&&i()},n=0,s=e;n<s.length;n++)r(s[n]);else i()})},t.prototype.animateNewTiles=function(e){var t=this;return new Promise(function(i){if(0!==e.length)for(var o=0,r=function(r){if(t.findTileNode(r.row,r.col))return console.log("\u0422\u0430\u0439\u043b \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442: row="+r.row+", col="+r.col),++o===e.length&&i(),"continue";var n=cc.instantiate(t.tilePrefab),s=r.col*t.tileSize+t.tileSize/2-t.gameModel.getWidth()*t.tileSize/2,a=1*t.tileSize-t.tileSize/2+t.gameModel.getHeight()*t.tileSize/2+100,l=r.col*t.tileSize+t.tileSize/2-t.gameModel.getWidth()*t.tileSize/2,c=-r.row*t.tileSize-t.tileSize/2+t.gameModel.getHeight()*t.tileSize/2;n.setPosition(s,a),n.setContentSize(t.tileSize,t.tileSize),t.tilesContainer.addChild(n),t.setTileSprite(n,r.type),n.tileRow=r.row,n.tileCol=r.col,n.tileType=r.type,n.on(cc.Node.EventType.TOUCH_END,function(){t.onTileClick(r.row,r.col,r.type)}),cc.tween(n).to(.4,{x:l,y:c},{easing:"backOut"}).call(function(){++o===e.length&&i()}).start()},n=0,s=e;n<s.length;n++)r(s[n]);else i()})},t.prototype.cleanupOldTiles=function(){for(var e=this.gameModel.getBoard(),t=0,i=this.tilesContainer.children.slice();t<i.length;t++){var o=i[t],r=o.tileRow,n=o.tileCol;if(r>=0&&r<this.gameModel.getHeight()&&n>=0&&n<this.gameModel.getWidth()){var s=e[r][n],a=o.tileType;-1!==s&&s===a||(console.log("\u0423\u0434\u0430\u043b\u044f\u0435\u043c \u043d\u0435\u0430\u043a\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0439 \u0442\u0430\u0439\u043b: ("+r+", "+n+") displayed="+a+", actual="+s),o.destroy())}}},t.prototype.animateNoMatch=function(e,t){var i=this.findTileNode(e,t);i&&cc.tween(i).to(.1,{scale:.8}).to(.1,{scale:1}).start()},t.prototype.animateScorePoints=function(e,t,i){if(!(e<=0)){var o=new cc.Node("ScoreText"),r=o.addComponent(cc.Label);r.string="+"+e,r.fontSize=24;var n=this.findTileNode(t,i);if(n){var s=n.parent.convertToWorldSpaceAR(n.position),a=this.node.convertToNodeSpaceAR(s);o.setPosition(a.x,a.y+50)}else o.setPosition(0,0);this.node.addChild(o),cc.tween(o).by(.5,{y:100}).by(.3,{opacity:-255}).call(function(){o.destroy()}).start()}},t.prototype.removeTilesVisual=function(e){var t=this;return new Promise(function(i){var o=0,r=e.length;if(0!==r)for(var n=function(e){var n=t.findTileNode(e.row,e.col);n?cc.tween(n).parallel(cc.tween().to(.2,{scale:0},{easing:"backIn"}),cc.tween().by(.2,{angle:180})).call(function(){n.destroy(),++o===r&&i()}).start():++o===r&&i()},s=0,a=e;s<a.length;s++)n(a[s]);else i()})},t.prototype.recreateBoardView=function(){this.tilesContainer&&this.tilesContainer.destroy(),this.createBoardView()},t.prototype.findTileNode=function(e,t){if(!this.tilesContainer)return null;for(var i=0,o=this.tilesContainer.children;i<o.length;i++){var r=o[i];if(r.tileRow===e&&r.tileCol===t&&r.isValid&&r.active)return r}return null},t.prototype.updateUI=function(){this.scoreLabel&&(this.scoreLabel.string=this.gameModel.getScore()+"/1000",cc.tween(this.scoreLabel.node).to(.1,{scale:1.2}).to(.1,{scale:1}).start()),this.movesLabel&&(this.movesLabel.string=""+this.gameModel.getMovesLeft())},t.prototype.setupBoardBorder=function(){for(var e=this.boardNode.children,t=this.gameModel.getWidth()*this.tileSize+2*this.internalPadding,i=this.gameModel.getHeight()*this.tileSize+2*this.internalPadding,o=0,r=e;o<r.length;o++){var n=r[o];"TilesContainer"!==n.name&&(n.name.includes("border")||n.name.includes("frame"))&&n.setContentSize(t,i)}},t.prototype.checkGameStatus=function(){var e=this.gameModel.checkGameStatus();0!==e&&this.gameOverNode&&(this.gameOverLabel.string=1===e?"\u041f\u041e\u0411\u0415\u0414\u0410!":"\u041f\u0420\u041e\u0418\u0413\u0420\u042b\u0428",this.gameOverNode.scale=0,this.gameOverNode.active=!0,cc.tween(this.gameOverNode).to(.3,{scale:1},{easing:"backOut"}).start())},t.prototype.getTileSize=function(){return this.tileSize},t.prototype.getTilesContainer=function(){return this.tilesContainer},n([u(cc.Prefab)],t.prototype,"tilePrefab",void 0),n([u(cc.Node)],t.prototype,"boardNode",void 0),n([u(cc.Label)],t.prototype,"scoreLabel",void 0),n([u(cc.Label)],t.prototype,"movesLabel",void 0),n([u(cc.Node)],t.prototype,"gameOverNode",void 0),n([u(cc.Label)],t.prototype,"gameOverLabel",void 0),n([u([cc.SpriteFrame])],t.prototype,"tileSprites",void 0),n([u({type:cc.SpriteFrame})],t.prototype,"rowBurnerSprite",void 0),n([u({type:cc.SpriteFrame})],t.prototype,"columnBurnerSprite",void 0),n([u({type:cc.SpriteFrame})],t.prototype,"radiusBurnerSprite",void 0),n([u({type:cc.SpriteFrame})],t.prototype,"fieldBurnerSprite",void 0),n([u],t.prototype,"boardPadding",void 0),n([u],t.prototype,"internalPadding",void 0),n([h],t)}(cc.Component);i.GameController=p,cc._RF.pop()},{"./GameModel":"GameModel"}],GameModel:[function(e,t,i){"use strict";cc._RF.push(t,"bc5c5Ea5clDH6+5MNURKXLu","GameModel");var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<i;t++)for(var n=arguments[t],s=0,a=n.length;s<a;s++,r++)o[r]=n[s];return o};Object.defineProperty(i,"__esModule",{value:!0}),i.GameModel=void 0;var r=function(){function e(){this.width=8,this.height=8,this.tileColors=5,this.score=0,this.movesLeft=20,this.targetScore=1e3,this.superTileThreshold=8,this.superTileSpawnChance=.02,this.superTileTypes={ROW_BURNER:5,COLUMN_BURNER:6,RADIUS_BURNER:7,FIELD_BURNER:8},this.burnRadius=1,this.board=[],this.initBoard()}return e.prototype.initBoard=function(){this.board=[];for(var e=0;e<this.height;e++){this.board[e]=[];for(var t=0;t<this.width;t++)Math.random()<this.superTileSpawnChance?this.board[e][t]=this.getRandomSuperTileType():this.board[e][t]=Math.floor(Math.random()*this.tileColors)}},e.prototype.getRandomSuperTileType=function(){var e=Object.values(this.superTileTypes);return e[Math.floor(Math.random()*e.length)]},e.prototype.isSuperTile=function(e){return e>=this.superTileTypes.ROW_BURNER},e.prototype.getSuperTileInfo=function(e){switch(e){case this.superTileTypes.ROW_BURNER:return{name:"\u0423\u043d\u0438\u0447\u0442\u043e\u0436\u0438\u0442\u0435\u043b\u044c \u0441\u0442\u0440\u043e\u043a",description:"\u0421\u0436\u0438\u0433\u0430\u0435\u0442 \u0432\u0441\u044e \u0441\u0442\u0440\u043e\u043a\u0443"};case this.superTileTypes.COLUMN_BURNER:return{name:"\u0423\u043d\u0438\u0447\u0442\u043e\u0436\u0438\u0442\u0435\u043b\u044c \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432",description:"\u0421\u0436\u0438\u0433\u0430\u0435\u0442 \u0432\u0435\u0441\u044c \u0441\u0442\u043e\u043b\u0431\u0435\u0446"};case this.superTileTypes.RADIUS_BURNER:return{name:"\u0412\u0437\u0440\u044b\u0432\u043d\u043e\u0439",description:"\u0421\u0436\u0438\u0433\u0430\u0435\u0442 \u0442\u0430\u0439\u043b\u044b \u0432 \u0440\u0430\u0434\u0438\u0443\u0441\u0435 "+this.burnRadius};case this.superTileTypes.FIELD_BURNER:return{name:"\u0410\u043f\u043e\u043a\u0430\u043b\u0438\u043f\u0441\u0438\u0441",description:"\u0421\u0436\u0438\u0433\u0430\u0435\u0442 \u0432\u0441\u0451 \u043f\u043e\u043b\u0435"};default:return{name:"\u041e\u0431\u044b\u0447\u043d\u044b\u0439 \u0442\u0430\u0439\u043b",description:""}}},e.prototype.activateSuperTile=function(e,t,i){var o=[];switch(this.copyBoard(),i){case this.superTileTypes.ROW_BURNER:o=this.burnRow(e);break;case this.superTileTypes.COLUMN_BURNER:o=this.burnColumn(t);break;case this.superTileTypes.RADIUS_BURNER:o=this.burnRadiusTiles(e,t);break;case this.superTileTypes.FIELD_BURNER:o=this.burnEntireField()}-1!==this.board[e][t]&&(o.push({row:e,col:t}),this.board[e][t]=-1);var r=this.processGravity(),n=this.fillEmptyTiles(),s=15*o.length;return this.score+=s,this.movesLeft--,{burnedTiles:o,movements:r,newTiles:n,points:s}},e.prototype.copyBoard=function(){return this.board.map(function(e){return o(e)})},e.prototype.burnRow=function(e){for(var t=[],i=0;i<this.width;i++)-1!==this.board[e][i]&&(t.push({row:e,col:i}),this.board[e][i]=-1);return t},e.prototype.burnColumn=function(e){for(var t=[],i=0;i<this.height;i++)-1!==this.board[i][e]&&(t.push({row:i,col:e}),this.board[i][e]=-1);return t},e.prototype.burnRadiusTiles=function(e,t){for(var i=[],o=e-this.burnRadius;o<=e+this.burnRadius;o++)for(var r=t-this.burnRadius;r<=t+this.burnRadius;r++)o>=0&&o<this.height&&r>=0&&r<this.width&&-1!==this.board[o][r]&&(i.push({row:o,col:r}),this.board[o][r]=-1);return i},e.prototype.burnEntireField=function(){for(var e=[],t=0;t<this.height;t++)for(var i=0;i<this.width;i++)-1!==this.board[t][i]&&(e.push({row:t,col:i}),this.board[t][i]=-1);return e},e.prototype.createSuperTile=function(e,t,i){this.board[e][t]=i},e.prototype.processMoveWithAnimations=function(e,t,i){if(void 0!==t&&void 0!==i&&this.isSuperTile(this.board[t][i])){var o=this.activateSuperTile(t,i,this.board[t][i]);return{points:o.points,movements:o.movements,newTiles:o.newTiles,activatedSuperTile:o}}if(e.length<2)return{points:0,movements:[],newTiles:[]};var r=t,n=i;this.removeTileGroup(e);var s,a=this.processGravity(),l=this.fillEmptyTiles();if(e.length>=this.superTileThreshold&&void 0!==r&&void 0!==n)if(r>=0&&r<this.height&&n>=0&&n<this.width&&-1!==this.board[r][n]){var c=this.getRandomSuperTileType();this.createSuperTile(r,n,c),s={row:r,col:n,type:c},console.log("\u0421\u043e\u0437\u0434\u0430\u043d \u0441\u0443\u043f\u0435\u0440-\u0442\u0430\u0439\u043b \u0442\u0438\u043f\u0430 "+c+" \u043d\u0430 \u043f\u043e\u0437\u0438\u0446\u0438\u0438 ("+r+", "+n+")")}else console.log("\u041f\u043e\u0437\u0438\u0446\u0438\u044f ("+r+", "+n+") \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u0434\u043b\u044f \u0441\u0443\u043f\u0435\u0440-\u0442\u0430\u0439\u043b\u0430");var h=10*e.length+(e.length>3?5*(e.length-3):0);return this.score+=h,this.movesLeft--,{points:h,movements:a,newTiles:l,createdSuperTile:s}},e.prototype.getBoard=function(){return this.board},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.findTileGroup=function(e,t){var i=this.board[e][t];if(-1===i)return[];for(var o=[],r=0;r<this.height;r++)o[r]=new Array(this.width).fill(!1);var n=[];return this.floodFill(e,t,i,o,n),n},e.prototype.floodFill=function(e,t,i,o,r){e<0||e>=this.height||t<0||t>=this.width||o[e][t]||this.board[e][t]===i&&(o[e][t]=!0,r.push({row:e,col:t}),this.floodFill(e-1,t,i,o,r),this.floodFill(e+1,t,i,o,r),this.floodFill(e,t-1,i,o,r),this.floodFill(e,t+1,i,o,r))},e.prototype.removeTileGroup=function(e){for(var t=0,i=e;t<i.length;t++){var o=i[t];this.board[o.row][o.col]=-1}},e.prototype.processGravity=function(){for(var e=[],t=0;t<this.width;t++)e.push.apply(e,this.processColumnGravity(t));return e},e.prototype.processColumnGravity=function(e){for(var t=[],i=this.height-1,o=this.height-1;o>=0;o--)-1!==this.board[o][e]&&(i!==o&&(t.push({from:{row:o,col:e},to:{row:i,col:e}}),this.board[i][e]=this.board[o][e],this.board[o][e]=-1),i--);return t},e.prototype.fillEmptyTiles=function(){for(var e=[],t=0;t<this.width;t++)for(var i=0;i<this.height;i++)if(-1===this.board[i][t]){var o=Math.random()<this.superTileSpawnChance?this.getRandomSuperTileType():Math.floor(Math.random()*this.tileColors);this.board[i][t]=o,e.push({row:i,col:t,type:o})}return e},e.prototype.checkGameStatus=function(){return this.score>=this.targetScore?1:this.movesLeft<=0?-1:this.hasValidMoves()?0:-1},e.prototype.hasValidMoves=function(){for(var e=0;e<this.height;e++)for(var t=0;t<this.width;t++)if(this.findTileGroup(e,t).length>=2)return!0;return!1},e.prototype.getScore=function(){return this.score},e.prototype.getMovesLeft=function(){return this.movesLeft},e.prototype.getTargetScore=function(){return this.targetScore},e.prototype.getSuperTileConfig=function(){return{types:this.superTileTypes,threshold:this.superTileThreshold,radius:this.burnRadius}},e}();i.GameModel=r,cc._RF.pop()},{}]},{},["GameController","GameModel"]);